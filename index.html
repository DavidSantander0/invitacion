<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Misión Secreta 💖</title>
<style>
body {
  margin:0; padding:0;
  background: radial-gradient(circle at center, #0f0c29, #302b63, #24243e);
  color: #fff; font-family: 'Poppins', sans-serif; text-align:center;
}
h1 { text-shadow:0 0 10px #ff00ff; margin-top:30px; }
#intro { font-size:1.3em; margin:20px auto; }
#puzzle1, #puzzle2, #finalMessage, #nextButton { display:none; margin-top:30px; }
#puzzle1 { display:flex; flex-wrap:wrap; justify-content:center; width:240px; margin:30px auto; }
.piece {
  width:80px; height:80px;
  border:1px solid #fff;
  box-sizing:border-box;
  cursor:pointer;
  background-size:240px 240px;
}
#puzzle2 input { font-size:1.5em; width:250px; text-align:center; padding:5px; border-radius:8px; border:none; outline:none; }
.message { font-size:1.3em; margin-top:20px; }
.confetti { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; overflow:hidden; z-index:10; }
.confetti-piece { position:absolute; width:10px; height:10px; background:hsl(var(--hue),70%,60%); top:-10px; animation:fall 3s linear infinite; }
@keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
button { padding:10px 20px; font-size:1em; border:none; border-radius:8px; background:#ff00ff; color:#fff; cursor:pointer; margin-top:20px; }
</style>
</head>
<body>
<h1>💖 Completa los 2 mini puzles 💖</h1>
<div id="intro"><button onclick="startPuzzle1()">Empezar Misión</button></div>

<div id="puzzle1"></div>
<button id="nextButton" onclick="goToPuzzle2()">Siguiente misión ➡️</button>

<div id="puzzle2">
  <p>🎮 Ordena las letras para descubrir el lugar 🍦</p>
 <p>FENGERRSTO 🍦</p>
  <input type="text" id="wordInput" placeholder="Escribe aquí..." maxlength="10">
  <button onclick="checkWord()">Verificar</button>
  <div id="puzzle2Message" class="message"></div>
</div>

<div id="finalMessage" class="message"></div>
<div id="confetti" class="confetti"></div>

<script>
// PUZZLE 1 - Drag & Drop usando índices
let puzzle1Completed = false;
const puzzle1 = document.getElementById('puzzle1');
const nextButton = document.getElementById('nextButton');
const imgURL = 'https://i.imgur.com/kDV4iCp.jpeg'; 

function startPuzzle1() {
  document.getElementById('intro').style.display = 'none';
  puzzle1.style.display = 'flex';
  const correctOrder = Array.from({length:9}, (_,i)=>i);
  const shuffled = correctOrder.slice().sort(()=>Math.random()-0.5);
  puzzle1.innerHTML='';
  shuffled.forEach(i=>{
    const div=document.createElement('div');
    div.classList.add('piece');
    div.style.backgroundImage = `url(${imgURL})`;
    const x = (i%3)*80;
    const y = Math.floor(i/3)*80;
    div.dataset.index = i; // índice correcto
    div.style.backgroundPosition = `-${x}px -${y}px`;
    div.draggable=true;
    div.addEventListener('dragstart',dragStart);
    div.addEventListener('dragover',dragOver);
    div.addEventListener('drop',dropPiece);
    puzzle1.appendChild(div);
  });
}

let dragged;
function dragStart(e){ dragged=e.target; }
function dragOver(e){ e.preventDefault(); }
function dropPiece(e){
  e.preventDefault();
  const tempPos = dragged.style.backgroundPosition;
  dragged.style.backgroundPosition = e.target.style.backgroundPosition;
  e.target.style.backgroundPosition = tempPos;

  const tempIndex = dragged.dataset.index;
  dragged.dataset.index = e.target.dataset.index;
  e.target.dataset.index = tempIndex;

  checkPuzzle1();
}

function checkPuzzle1(){
  const pieces = document.querySelectorAll('.piece');
  let correctCount = 0;
  pieces.forEach((p,i)=>{
    if(p.dataset.index==i) correctCount++;
  });
  if(correctCount===9 && !puzzle1Completed){
    puzzle1Completed = true;
    showConfetti();
    nextButton.style.display = 'inline-block';
  }
}

// PASAR AL PUZZLE 2
function goToPuzzle2(){
  puzzle1.style.display = 'none';
  nextButton.style.display = 'none';
  puzzle2.style.display = 'block';
}

// PUZZLE 2
function checkWord(){
  const val = document.getElementById('wordInput').value.toUpperCase();
  if(val==='GREENFROST') showFinalMessage();
  else document.getElementById('puzzle2Message').innerText='❌ Casi, intenta de nuevo.';
}

// FINAL MESSAGE + CONFETTI
function showFinalMessage(){
  puzzle2.style.display='none';
  const final = document.getElementById('finalMessage');
  final.innerHTML=`
    🎮 ¡Misión cumplida, miamor! 🎮<br>
    Te invito a comer helado en <strong>Greenfrost 😈</strong><br>
    Hora: medio día 🍦<br>
    Fecha: por definir porque mi preciosa tiene la agenda super ocupaa 😏<br>
    Atentamente, David 💻❤️
  `;
  final.style.display='block';
  showConfetti();
}

// Confetti
function showConfetti(){
  const confettiEl = document.getElementById('confetti');
  for(let i=0;i<100;i++){
    const piece=document.createElement('div');
    piece.classList.add('confetti-piece');
    piece.style.left=Math.random()*100+'vw';
    piece.style.animationDuration=2+Math.random()*3+'s';
    piece.style.setProperty('--hue',Math.random()*360);
    confettiEl.appendChild(piece);
    setTimeout(()=>piece.remove(),3000);
  }
}
</script>
</body>
</html>
